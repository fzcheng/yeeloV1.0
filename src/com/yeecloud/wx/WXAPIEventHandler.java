package com.yeecloud.wx;import java.util.HashMap;import java.util.Iterator;import org.json.JSONException;import org.json.JSONObject;import android.app.Activity;import android.app.AlertDialog;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.text.TextUtils;import android.util.Log;import android.widget.Toast;import com.tencent.mm.sdk.modelbase.BaseReq;import com.tencent.mm.sdk.modelbase.BaseResp;import com.tencent.mm.sdk.modelpay.PayReq;import com.tencent.mm.sdk.openapi.IWXAPI;import com.tencent.mm.sdk.openapi.IWXAPIEventHandler;import com.tencent.mm.sdk.openapi.WXAPIFactory;import com.yeecloud.Constant;import com.yeecloud.pay.k;public class WXAPIEventHandler implements IWXAPIEventHandler {	private static WXAPIEventHandler b = new WXAPIEventHandler();	private IWXAPI c;	private Activity d;	private k e;	final Handler a = new Handler() {		@Override		public void handleMessage(Message paramMessage) {			int i = paramMessage.what;			String str1 = (String) paramMessage.obj;			switch (i) {			case -1:				Toast.makeText(d, "网络异常", 0).show();				e.Failure();				break;			case 200:				try {					JSONObject localJSONObject = new JSONObject(str1);					int j = 200;//localJSONObject.getInt("code");					//String str2 = localJSONObject.getString("msg");					if (j == 200) {						PayReq localPayReq = new PayReq();						localPayReq.appId = localJSONObject.getString("appid");						localPayReq.partnerId = localJSONObject								.getString("partnerid");						localPayReq.prepayId = localJSONObject								.getString("prepayid");						localPayReq.nonceStr = localJSONObject								.getString("noncestr");						localPayReq.timeStamp = localJSONObject								.getString("timestamp");						localPayReq.packageValue = localJSONObject								.getString("package");						localPayReq.sign = localJSONObject.getString("sign");						localPayReq.extData = "app data";						//String str3 = localJSONObject.getString("orderId");						Toast.makeText(d, "正常调起支付", 0).show();						c.sendReq(localPayReq);						//e.a(str3);					} else {						e.Failure();						//Toast.makeText(d, str2, 0).show();					}				} catch (JSONException localJSONException) {					Log.e("MqhyWxPay",							"数据解析错误" + localJSONException.getMessage());					e.Failure();					Toast.makeText(d, "数据解析错误", 0).show();				}				break;			default:				e.Failure();				Toast.makeText(d, "服务器请求错误", 0).show();				break;			}		}	};	private String f;	public static WXAPIEventHandler a() {		return b;	}	public void a(Activity paramActivity, Bundle paramBundle, k paramk) {		this.e = paramk;		this.d = paramActivity;		String str1 = paramBundle.getString("wxappid");		if (TextUtils.isEmpty(str1)) {			Toast.makeText(paramActivity, "请输入正确的wxappid", 0).show();			return;		}		this.c = WXAPIFactory.createWXAPI(paramActivity, null);		this.c.registerApp(str1);		this.c.handleIntent(paramActivity.getIntent(), this);		String str2 = Constant.BASE_URL + "sdk/pay/wxapp.do";		HashMap localHashMap = new HashMap();		if (paramBundle != null) {			Iterator localIterator = paramBundle.keySet().iterator();			while (localIterator.hasNext()) {				String str3 = (String) localIterator.next();				localHashMap.put(str3, paramBundle.getString(str3));			}		}		new WxPayThread(this, this.a, str2, localHashMap).start();	}	public void onReq(BaseReq paramBaseReq) {	}	public void onResp(BaseResp paramBaseResp) {		Log.d("MqhyWxPay", "onPayFinish, errCode = " + (paramBaseResp == null));		Toast.makeText(this.d, paramBaseResp.errStr, 0).show();		if (paramBaseResp.getType() == 5) {			AlertDialog.Builder localBuilder = new AlertDialog.Builder(this.d);			localBuilder.setTitle("提示");			localBuilder.setMessage("微信支付结果:"					+ String.valueOf(paramBaseResp.errCode));			localBuilder.show();		}	}	public void a(String paramString) {		this.f = paramString;	}	public void a(int paramInt) {		if (paramInt == 0)			this.e.Success(this.f);		else			this.e.Failure();	}}